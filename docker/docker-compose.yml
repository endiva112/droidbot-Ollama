version: '3.8'

services:
  ollama:
    image: ollama/ollama
    container_name: droidbot-ollama
    network_mode: host
    volumes:
      - ollama_data:/root/.ollama

  droidbot:
    build:
      context: ..
      dockerfile: docker/Dockerfile
    container_name: droidbot-app
    network_mode: host
    volumes:
      - ..:/app
    working_dir: /app
    environment:
      - OLLAMA_HOST=http://localhost:11434
      - OLLAMA_MODEL=gemma3:4b
    stdin_open: true
    tty: true
    command: >
      bash -c "
      echo 'Conectando a emulador Android...';
      adb connect host.docker.internal:5555 2>/dev/null;
      sleep 1;
      echo '';
      echo 'Dispositivos conectados:';
      adb devices;
      echo '';
      echo 'Listo para ejecutar DroidBot';
      echo '';
      echo 'Ejemplo:';
      echo '  python start.py -a com.google.android.deskclock -o output/ -policy llm_dfs';
      echo '';
      exec bash
      "

volumes:
  ollama_data: